# ğŸ—ï¸ Kiáº¿n TrÃºc Há»‡ Thá»‘ng Vision AI PhÃ¢n TÃ¡n

## ğŸ“ SÆ¡ Äá»“ Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸŒ Máº NG LAN (1Gbps)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“¹ Camera Dahua (RTSP)       â”‚    â”‚  ğŸ“¹ Camera Dahua (RTSP)    â”‚ â”‚
â”‚  â”‚  192.168.1.4                  â”‚    â”‚  192.168.1.7               â”‚ â”‚
â”‚  â”‚  rtsp://admin:***@.../cam/... â”‚    â”‚  rtsp://admin:***@.../...  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚                                     â”‚                â”‚
â”‚                 â”‚                                     â”‚                â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                â–¼                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚     â”‚  ğŸ“ RASPBERRY PI 4 (Edge Node)                      â”‚           â”‚
â”‚     â”‚  IP: 192.168.1.50 (example)                         â”‚           â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚     â”‚  â”‚  1ï¸âƒ£ RTSP Client Service                     â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - Nháº­n stream tá»« 2 cameras                 â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - Frame sampling (1-5 FPS)                 â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - Auto reconnect                           â”‚  â”‚           â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚     â”‚                      â–¼                              â”‚           â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚     â”‚  â”‚  2ï¸âƒ£ Detection Pipeline (Optional)           â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - YOLOv8n (lightweight)                     â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - Bounding boxes                            â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - Object tracking                           â”‚  â”‚           â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚     â”‚                      â–¼                              â”‚           â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚     â”‚  â”‚  3ï¸âƒ£ Backend API (FastAPI)                   â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - REST endpoints                            â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - WebSocket for realtime                    â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - Request queue management                  â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  Port: 8001                                  â”‚  â”‚           â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚     â”‚                      â–¼                              â”‚           â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚     â”‚  â”‚  4ï¸âƒ£ Frontend UI (React)                     â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - Camera feeds display                      â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - Detection results                         â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - Chat interface                            â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  Port: 3000                                  â”‚  â”‚           â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                           â”‚ HTTP Request                               â”‚
â”‚                           â”‚ (Image + Prompt)                           â”‚
â”‚                           â–¼                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚     â”‚  ğŸ–¥ PC (Inference Node)                             â”‚           â”‚
â”‚     â”‚  IP: 192.168.1.100 (example)                        â”‚           â”‚
â”‚     â”‚  GPU: GTX 1050 Ti (4GB VRAM)                        â”‚           â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚     â”‚  â”‚  llama.cpp Inference Server                  â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  Port: 8080                                  â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  â”‚  Model: Vintern-1B-v3.5 GGUF Q8_0     â”‚ â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  â”‚  - Vision Encoder: 318MB               â”‚ â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  â”‚  - Language Model: 644MB               â”‚ â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  â”‚  - Total VRAM: ~1-1.5GB                â”‚ â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  API: OpenAI-compatible                      â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - /health                                   â”‚  â”‚           â”‚
â”‚     â”‚  â”‚  - /v1/chat/completions                      â”‚  â”‚           â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                           â”‚ Response (JSON)                            â”‚
â”‚                           â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Data Flow

```
Camera RTSP Stream (H.264)
    â”‚
    â–¼
[Pi] RTSP Client â†’ Frame Extraction (640x480)
    â”‚
    â–¼
[Pi] Detection Pipeline (Optional)
    â”‚ Objects detected
    â–¼
[Pi] Backend API
    â”‚ Prepare request:
    â”‚ - Encode image to Base64
    â”‚ - Add prompt
    â”‚ - Add detected objects context
    â–¼
[LAN] HTTP Request â†’ PC Inference Server
    â”‚
    â–¼
[PC] llama.cpp Server
    â”‚ - Vision encoder processes image
    â”‚ - Language model generates response
    â”‚ - Return JSON
    â–¼
[LAN] HTTP Response â† PC
    â”‚
    â–¼
[Pi] Backend process response
    â”‚
    â–¼
[Pi] Frontend display results
```

## âš™ï¸ Cáº¥u HÃ¬nh Chi Tiáº¿t

### ğŸ–¥ PC (Inference Node)

| Component | Specification |
|-----------|--------------|
| CPU | Intel Core i3-10105F @ 3.70GHz (4C/8T) |
| RAM | 16GB |
| GPU | GTX 1050 Ti 4GB VRAM |
| Driver | NVIDIA 580.126.09 |
| CUDA | 13.0 (driver-only) |
| OS | Ubuntu 22.04 |

**Cháº¡y:**
- llama.cpp inference server
- Model: Vintern-1B-v3.5 GGUF Q8_0
- Mode: CPU-only (cÃ³ thá»ƒ upgrade lÃªn GPU)
- Port: 8080
- API: OpenAI-compatible

**VRAM Budget:**
```
Model weights:     ~1000 MB
KV Cache (2048):    ~200 MB
Activations:        ~100 MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:             ~1300 MB / 4096 MB âœ…
CÃ²n dÆ°:            ~2700 MB
```

### ğŸ“ Raspberry Pi 4 (Edge Node)

| Component | Requirements |
|-----------|--------------|
| RAM | 4GB+ (recommended 8GB) |
| OS | Ubuntu 22.04 ARM64 hoáº·c Raspberry Pi OS 64-bit |
| Python | 3.8+ |
| Storage | SD Card Class 10 UHS-I (16GB+) |

**Cháº¡y:**
- RTSP client (2 cameras)
- Detection pipeline (YOLOv8n)
- Backend API (FastAPI)
- Frontend UI (React)

**RAM Budget:**
```
RTSP streams:       ~200 MB
YOLOv8n model:      ~50 MB
Backend API:        ~100 MB
Frontend:           ~50 MB
Frame buffers:      ~100 MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:             ~500 MB / 4GB âœ…
Safe zone:          ~1GB usage
```

### ğŸ“¡ Network Requirements

| Parameter | Requirement |
|-----------|-------------|
| LAN Speed | 100Mbps+ (1Gbps recommended) |
| Latency | <5ms (local network) |
| Static IP | Recommended cho cáº£ PC vÃ  Pi |
| Ports | 8080 (PC), 8001 (Pi Backend), 3000 (Pi Frontend) |

**Bandwidth Estimate:**
```
1 camera stream (640x480 @ 5 FPS):
- Image size: ~50 KB/frame  
- Base64 encoded: ~70 KB/frame
- 5 FPS â†’ 350 KB/s â†’ 2.8 Mbps
- 2 cameras â†’ ~6 Mbps

Total with overhead: ~10 Mbps
100Mbps LAN: âœ… OK
```

## ğŸš€ Performance Estimates

### Current (CPU-only)

| Metric | Value |
|--------|-------|
| Inference Time | 2-3 seconds |
| Throughput | ~20-30 requests/min |
| GPU VRAM | 0 MB (CPU-only) |
| CPU Usage | ~100% (4 cores) |
| Power | ~65W |

### Vá»›i GPU CUDA (Future)

| Metric | Value |
|--------|-------|
| Inference Time | 0.3-0.5 seconds |
| Throughput | ~120-200 requests/min |
| GPU VRAM | ~1.3 GB / 4 GB |
| CPU Usage | ~20% |
| Power | ~120W |

## ğŸ¯ API Specification

### PC Inference Server

**Base URL:** `http://<PC_IP>:8080`

**Endpoints:**

1. **Health Check**
   ```
   GET /health
   Response: {"status": "ok"}
   ```

2. **Chat Completions** (OpenAI-compatible)
   ```
   POST /v1/chat/completions
   Content-Type: application/json
   
   {
     "messages": [
       {
         "role": "user",
         "content": [
           {"type": "image_url", "image_url": {"url": "data:image/jpeg;base64,..."}},
           {"type": "text", "text": "Describe this image"}
         ]
       }
     ],
     "max_tokens": 200,
     "temperature": 0.1
   }
   ```

### Pi Backend API

**Base URL:** `http://<Pi_IP>:8001`

**Endpoints:**

1. **System Health**
   ```
   GET /health
   ```

2. **Camera Status**
   ```
   GET /stream-status
   ```

3. **Detection**
   ```
   POST /detect
   ```

4. **Ask VLM**
   ```
   POST /ask-llm
   Body: {
     "camera_id": 1,
     "prompt": "What do you see?",
     "include_detections": true
   }
   ```

5. **System Info**
   ```
   GET /system-info
   ```

## ğŸ”’ Security Considerations

1. **Network Isolation**
   - Cháº¡y trÃªn LAN ná»™i bá»™, khÃ´ng expose ra internet
   - Firewall cháº·n ports tá»« WAN

2. **Camera Authentication**
   - RTSP URLs cÃ³ username/password
   - LÆ°u trong `.env`, khÃ´ng commit

3. **Access Control**
   - Frontend chá»‰ truy cáº­p tá»« LAN
   - API khÃ´ng cÃ³ public endpoints

## ğŸ“Š Monitoring

### PC
```bash
# GPU monitoring (náº¿u cÃ³ CUDA)
watch -n 1 nvidia-smi

# CPU/RAM
htop

# Server logs
tail -f /home/baobao/Projects/Vintern-1b-v3.5-demo/pc-inference-server/logs/server_*.log
```

### Pi
```bash
# CPU temperature
vcgencmd measure_temp

# Memory
free -h

# Processes
htop
```

## ğŸ› Common Issues & Solutions

| Issue | Cause | Solution |
|-------|-------|----------|
| Pi khÃ´ng connect Ä‘Æ°á»£c PC | Firewall/Network | Check firewall, ping test |
| Inference quÃ¡ cháº­m | CPU-only | Rebuild llama.cpp vá»›i CUDA |
| RTSP timeout | Camera offline | Check camera connection, auto-reconnect |
| RAM overflow Pi | Leak/buffer | Implement frame buffer limits |
| GPU OOM | VRAM full | Giáº£m batch_size, ctx_size |

## ğŸ“ Next Steps

1. âœ… **PC Setup Complete** - Inference server ready
2. â­ï¸ **Pi Setup** - Install dependencies, RTSP client
3. â­ï¸ **Backend API** - Create FastAPI endpoints
4. â­ï¸ **Frontend** - Build React UI
5. â­ï¸ **Integration Test** - Full pipeline test
6. â­ï¸ **Optimization** - GPU support, caching, etc.

---

**XÃ¡c nháº­n Ä‘á»ƒ tiáº¿p tá»¥c setup Raspberry Pi!**
